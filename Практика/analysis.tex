\chapter{Аналитическая часть}

\section{Анализ алгоритмов удаления невидимых линий и поверхностей}

\subsection{Алгоритм обратной трассировки}

Алгоритм обратной трассировки лучей отслеживает лучи в обратном направлении (от наблюдателя к объекту). Считается, что наблюдатель расположен на положительной полуоси z в бесконечности, поэтому все световые лучи параллельны оси z. В ходе работы испускаются лучи от наблюдателя и ищутся пересечения луча и всех объектов сцены. В результате, пересечение с максимальным значением z является видимой частью поверхности, и атрибуты данного объекта используются для определения характеристик пикселя, через центр которого проходит данный световой луч. 

\imgHeight{60mm}{trace.png}{Алгоритм обратной трассировки}

Эффективность процедуры определения пересечений луча с поверхностью объекта оказывает самое большое влияние на эффективность всего алгоритма. Чтобы избавиться от ненужного поиска пересечений было придумано искать пересечение луча с объемной оболочкой рассматриваемого объекта. Под оболочкой понимается некоторый простой объект, внутрь которого можно поместить рассматриваемый объект, к примеру параллелепипед или сферу. 

В дальнейшем при рассмотрении пересечения луча и объемной оболочкой рассматриваемого объекта, если такого пересечения нет, то и соответственно пересечения луча и самого рассматриваемого объекта нет, и наоборот, пересечение найдено, то возможно, есть пересечение луча и рассматриваемого объекта. 

Для расчета эффектов освещения сцены проводятся вторичные лучи от точек пересечения ко всем источникам света. Если на пути этих лучей встречается непрозрачное тело, значит данная точка находится в тени, иначе он влияет на освещение данной точки. Также для получения более реалистичного изображения сцены, нужно учитывать вклады отраженных и преломленных лучей.

Плюсы:

\begin{itemize}
	\item возможность использования алгоритма в параллельных вычислительных системах.
\end{itemize}

Минусы:

\begin{itemize}
	\item требуется большое количество высислений;
	\item производительность алгоритма.
\end{itemize}

\subsection{Алгоритм Робертса}

Алгоритм Робертса работает в объектном пространстве, кроме того работает только с выпуклыми телами. Если тело изначально является не выпуклым, то нужно его разбить на выпуклые составляющие.

Данный алгоритм состоит из следующих основных этапов:

\begin{itemize}
	\item подготовка исходных данных;
	\item удаление линий, экранируемых самим телом;
	\item удаление линий, экранируемых другими телами.
\end{itemize}


Для определения, лежит ли точка в положительном подпространстве, используют проверку знака скалярного произведения $(l, n)$, где $l$ – вектор, направленный к наблюдателю, фактически определяет точку наблюдения; $n$ – вектор внешней нормали грани. Если $(l, n)$ > 0, т. е. угол между векторами острый, то грань является лицевой. Если $(l, n)$ < 0, т. е. угол между векторами тупой, то грань является нелицевой.
В алгоритме Робертса требуется, чтобы все изображаемые тела или объекты были выпуклыми. Невыпуклые тела должны быть разбиты на выпуклые части. В этом алгоритме выпуклое многогранное тело с плоскими гранями должно представиться набором пересекающихся плоскостей. Уравнение произвольной плоскости в трехмерном пространстве имеет вид

\begin{equation}
	ax+by+cz+d = 0
\end{equation}

В матричной форме этот результат выглядит так:

\begin{equation}
	[x \: y \: z \: 1][P]^T = 0
\end{equation}

где $[P]^T$ = $[a \; b \; c \; d]$ представляет собой плоскость. Поэтому любое выпуклое твердое тело можно выразить матрицей тела, состоящей из коэффициентов уравнений плоскостей, т. е.

\begin{equation}
	M = \begin{bmatrix}
		a_1 & a_2 & ... & a_n           \\[0.3em]
		b_1 & b_2 & ... & b_n           \\[0.3em]
		c_1 & c_2 & ... & c_n           \\[0.3em]
		d_1 & d_2 & ... & d_n           \\[0.3em]
	\end{bmatrix},
\end{equation}

где каждый столбец содержит коэффициенты одной плоскости.

Любая точка пространства представима в однородных координатах вектором $[S]$ = $[x \; y \; z \; 1]$. Более того, если точка $[S]$ лежит на плоскости, то $[S]*[P]^T$ = 0. Если же $[S]$ не лежит на плоскости, то знак этого скалярного произведения показывает, по какую сторону от плоскости расположена точка. В алгоритме Робертса предполагается, что точки, лежащие внутри тела, дают отрицательное скалярное произведение, т. е. нормали направлены наружу. 

Плюсы алгоритма:

\begin{itemize}
	\item высокая точность вычислений.
\end{itemize}

Минусы:

\begin{itemize}
	\item рост числа трудоемкости алгоритма, как квадрата числа объектов;
	\item работа только с выпуклыми телами.
\end{itemize}

\subsection{Алгоритм, использующий Z-буфер}

Алгоритм Z-буфера решает задачу в пространстве изображений. 

В данном алгоритме рассматривается два буфера. Буфер кадра (регенерации) используется для заполнения атрибутов (интенсивности) каждого пикселя в пространстве изображения. В Z-буфер (буфер глубины) можно помещать информацию о координате z для каждого пикселя.

Для начала необходимо подготовить буферы. Для этого в Z-буфер заносятся максимально возможные значения z, а буфер кадра заполняется значениями пикселя, который описывает фон. Также нужно каждый многоугольник преобразовать в растровую форму и записать в буфер кадра. Сам процесс работы заключается в сравнении глубины каждого нового пикселя, который нужно занести в буфер кадра,
с глубиной того пикселя, который уже занесён в Z-буфер. В зависимости от сравнения принимается решение, нужно ли заносить новый пиксель в буфер кадра и, если нужно, также корректируется Z-буфер (в него нужно занести глубину нового пикселя).

Плюсы:
\begin{itemize}
	\item элементы сцены заносятся в буфер кадра в произвольном порядке, поэтому в данном алгоритме не тратится время на выполнение сортировок;
	\item произвольная сложность сцены;
	\item поскольку размеры изображения ограничены размером экрана дисплея, трудоемкость алгоритма зависит линейно от числа рассматриваемых поверхностей.
\end{itemize}

Минусы:
\begin{itemize}
	\item трудоемкость устранения лестничного эффекта;
	\item трудности реализации эффектов прозрачности;
	\item большой объем требуемой памяти.
\end{itemize}

\subsection*{Вывод}

Для удаления невидимых линий и поверхностей выбран алгоритм Z-буфера, так как обладает важными преимуществами - высокой скоростью работы и произвольной сложностью сцены.


\section{Анализ методов закрашивания}

Методы закрашивания используются для затенения полигонов (или по-
верхностей, аппроксимированных полигонами) в условиях некоторой сцены, имеющей источники освещения.

Существует несколько основных методов закраски:
\begin{itemize}
	\item простая закраска;
	\item закраска по Гуро, основанная на интерполяции значений интенсивности освещенности поверхности;
	\item закраска по Фонгу, основанная на интерполяции векторов нормалей к граням многогранника.
\end{itemize}

\subsection{Простая закраска}

Одной из самых простых моделей освещения является модель Ламберта. Она учитывает только идеальное диффузное отражение света от тела. Считается, что свет падающий в точку, одинаково рассеивается по всем направлениям полупространства. Таким образом, освещенность в точке определяется только плотностью света в точке поверхности, а она линейно зависит от косинуса угла падения. При этом положение наблюдателя не имеет значение, т.к. диффузно отраженный свет рассеивается равномерно по всем направлениям.

Простая закраска используется при выполнении трех условий:
 \begin{itemize}
 	\item предполагается, что источник находится в бесконечности;
 	\item предполагается, что наблюдатель находится в бесконечности;
 	\item закрашиваемая грань является реально существующей, а не полученной в результате аппроксимации поверхности.
 \end{itemize}

Большим недостатком данной модели является то, что согласно приведённой выше формуле, все точки грани будут иметь одинаковую интенсивность.

\imgHeight{60mm}{draw_simple.png}{Пример простой закраски}

\subsection{Закраска по Гуро}

Данный алгоритм предполагает следующие шаги:

\begin{itemize}
	\item вычисление векторов нормалей к каждой грани;
	\item вычисление векторов нормали к каждой вершине грани путем усреднения нормалей к граням;
	\item вычисление интенсивности в вершинах грани;
	\item интерполяция интенсивности вдоль ребер грани;
	\item линейная интерполяция интенсивности вдоль сканирующей строки.
\end{itemize}

Плюсы:

\begin{itemize}
	\item хорошо сочетается с диффузным отражением;
	\item изображение получается более реалистичным, чем при простой закраске.
\end{itemize}

Минусы:

\begin{itemize}
	\item данный метод интерполяции обеспечивает лишь непрерывность значений интенсивности вдоль границ многоугольников, но не обеспечивает непрерывность изменения интенсивности.
\end{itemize}

\imgHeight{60mm}{draw_guro.png}{Пример закраски по Гуро}

\subsection{Закраска по Фонгу}

При такой закраске, в отличие от метода Гуро, вдоль сканирующей строки интерполируется значение вектора нормали, а не интенсивности. 

Шаги алгоритма:

\begin{itemize}
	\item вычисление векторов нормалей в каждой грани.
	\item вычисление векторов нормали к каждой вершине грани.
	\item интерполяция векторов нормалей вдоль ребер грани.
	\item линейная интерполяция векторов нормалей вдоль сканирующей строки.
	\item вычисление интенсивности в очередной точке сканирующей строки.
\end{itemize}

Плюсы:

\begin{itemize}
	\item можно достичь лучшей локальной аппроксимации кривизны поверхности.
\end{itemize}

Минусы:

\begin{itemize}
	\item ресурсоемкость;
	\item вычислительная сложность.
\end{itemize}

\imgHeight{60mm}{draw_phong.png}{Пример закраски по Фонгу}

\subsection*{Вывод}

Для закрашивания выбран алгоритм Фонга, так как данный алгоритм обладает важным преимуществом - высокой реалистичностью изображения.


\section*{Вывод}

В данном разделе были формально описаны алгоритмы удаления невидимых линий и поверхностей, методы закрашивания поверхностей. В качестве алгоритма удаления невидимых линий и поверхностей был выбран алгоритм Z-буфера, в качестве метода закрашивания был выбран алгоритм закраски Фонга.

